# Design Doc: Terminology, Concepts, and Relations

## Instance ID

- The Hacky-Helper-CRX extenation can run one multiple browsers.
- Each extention has "instance ID" to distinguish it from others.
- The instance ID is a string of alphanumerical characters.
- The instance ID is set randomly if not set.
- The user can mofigy it in the Settings UI.

## Session

- A manageable unit of user tasks, tightly connected with a browser window and the tabs in it.
- A session can be either "named" or "unnamed".
- Essential information associated with the sessions are the followings. See also "Summary of Sessions/Tabs" below.
  - Session ID (UUID, Generated by Hacky-Helper)
  - Window ID (number, Generated by Browser)
  - Name (string, Named by the user)
  - Open Tabs
  - Saved Bookrmarks.
- A session can have some metadata, e.g. ordering, createdAt, updatedAt.
- **Tab Migration:** Tabs can be moved between sessions (specifically, between the browser windows associated with active sessions). This can be initiated via:
  - **Button Clicks:** Using dedicated buttons in the UI (e.g., "Migrate Selected Tabs" button, suggestions in the migration dialog).
  - **Drag-and-Drop:** Dragging tab(s) from the tab list and dropping them onto an active session item in the session list (`tabs.html`). Currently, this targets active sessions/windows. Migration to _closed_ sessions via drag-and-drop is a planned feature (TODO).

### Named Sessions

- A session named by the user for long-term, cross-device, and persistent usage.
- A named session is managed by the combination of in local (sessino-management.ts) and in-backend (BookmarkStorage.ts) management.
- A named session consists of "open tabs" and "saved bookmarks".
- A Named Session can be either "Open" or "Closed".

#### Open Tabs

- Represents the tabs currently active on any of the devices.
- unsynced tabs of a named session. These are dynamically updated and maintained via an auto-save mechanism.

##### Synced Open Tabs

- Open Tabs those also exist in the backend.
- Existence is defined by the URL and the `owner` field.

#### Saved Tabs/Bookmarks

- Consists of sessions stored in Chrome's Bookmarks. This backup enables session restoration even when the associated window is closed.

### Active Named Sessions

Active Named Sessions represent sessions that are currently active and bound to their respective browser windows. They are managed locally via Chrome's storage API using the key "hacky_helper_named_sessions" and are continuously updated in real-time to reflect the current state.

### Closed Named Sessions

- A Named Session which only exists

- Closed Named Sessions are archived using the Chrome Bookmarks API and can be restored when needed.

### Unamed Sessions

### Summary of Sessions/Tabs

- "in Local": manageed by in-local management `session-management.ts`.
- "in Backend": manageed by in-backend management `BookmarkStorage.ts`.

<table>
  <thead>
    <tr>
      <th>L1 Concept</th>
      <th>L2 Modifier</th>
      <th>L3 Modifier</th>
      <th>has sessionId</th>
      <th>has windowId</th>
      <th>in Local</th>
      <th>in Backend</th>
    </tr>
  </thead>
  <tr>
    <td rowspan="3">Session</td>
    <td rowspan="2">Named</td>
    <td>Active</td>
    <td>✅</td>
    <td>✅</td>
    <td>✅</td>
    <td>✅</td>
  </tr>
  <tr>
    <!-- <td>.</td> -->
    <td>Closed</td>
    <td>✅</td>
    <td>-</td>
    <td>-</td>
    <td>✅</td>
  </tr>
  <tr>
    <!-- <td>.</td> -->
    <td>Unnamed</td>
    <td>(<i>open</i>)</td>
    <td>-</td>
    <td>✅</td>
    <td>✅</td>
    <td>-</td>
  </tr>
  <tr>
    <td rowspan="2" colspan="2">Open Tabs</td>
    <td>Synced</td>
    <td>✅</td>
    <td></i>depends</i></td>
    <td><i>n/a</i></td>
    <td>✅</td>
  </tr>
  <tr>
    <td>Unsynced</td>
    <td>-</td>
    <td>✅</td>
    <td><i>n/a</i></td>
    <td>-</td>
  </tr>
  <tr>
    <td colspan="2">Saved Bookmarks</td>
    <td><i>(synced)</i></td>
    <td>✅</td>
    <td><i>n/a</i></td>
    <td><i>n/a</i></td>
    <td>✅</td>
  </tr>
</table>

## UI

## Data Storage/Synchronization

### In-memory/Local Storage

(Technically, it might or might not be in-memory, but we call this layer sometimes in-memory or just local)

-

### Backend Storage

- Effectively this is Chrome Browser's Bookmark folders for now. This layer provides persistence for Named Sessions (both Active and Closed), including their associated Open Tabs (synced) and Saved Bookmarks.
- Synchronization between the local session state and this backend is handled by `BookmarkStorage.ts`.
- Manual synchronization can be triggered via the "Force Sync to Backend" action in the UI, which ultimately calls `SessionManagement.syncSessionToBackend`.
- Automatic synchronization also occurs periodically (managed by the service worker).
